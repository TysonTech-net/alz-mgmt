{
  "name": "PI-Evri-Tagging-Baseline",
  "type": "Microsoft.Authorization/policySetDefinitions",
  "apiVersion": "2024-04-01",
  "properties": {
    "policyType": "Custom",
    "displayName": "EVRi Tagging Baseline",
    "description": "MC: Policy Initiative for mandatory tagging adding x6 Policy Definitions of \"Require a tag on resources\"",
    "metadata": {
      "version": "1.0.0",
      "category": "Tags"
    },
    "parameters": {
      "patchGroupTagValues": {
        "type": "Array",
        "metadata": {
          "displayName": "Patch Group Tag Values",
          "description": "Allowed values for the PatchGroup tag on virtual machines."
        },
        "defaultValue": []
      },
      "backupTagValues": {
        "type": "Array",
        "metadata": {
          "displayName": "Backup Tag Values",
          "description": "Allowed values for the Backup tag on virtual machines."
        },
        "defaultValue": []
      },
      "excludedResourceTypes": {
        "type": "Array",
        "metadata": {
          "displayName": "Excluded resource types",
          "description": "Resource types to exclude from the Enforce-Resource-Tag policy."
        },
        "defaultValue": []
      }
    },
    "policyDefinitions": [
      {
        "policyDefinitionReferenceId": "PD-Custom-Tagging-Description-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/Enforce-Resource-Tag",
        "parameters": {
          "tagName": { "value": "Description" },
          "excludedResourceTypes": {
            "value": "[parameters('excludedResourceTypes')]"
          }
        },
        "groupNames": ["Resource-Tags"]
      },
      {
        "policyDefinitionReferenceId": "PD-Custom-Tagging-Owner-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/Enforce-Resource-Tag",
        "parameters": {
          "tagName": { "value": "Owner" },
          "excludedResourceTypes": {
            "value": "[parameters('excludedResourceTypes')]"
          }
        },
        "groupNames": ["Resource-Tags"]
      },
      {
        "policyDefinitionReferenceId": "PD-Custom-Tagging-Environment-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/Enforce-Resource-Tag",
        "parameters": {
          "tagName": { "value": "Environment" },
          "excludedResourceTypes": {
            "value": "[parameters('excludedResourceTypes')]"
          }
        },
        "groupNames": ["Resource-Tags"]
      },
      {
        "policyDefinitionReferenceId": "PD-Custom-Tagging-Service-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/Enforce-Resource-Tag",
        "parameters": {
          "tagName": { "value": "Service" },
          "excludedResourceTypes": {
            "value": "[parameters('excludedResourceTypes')]"
          }
        },
        "groupNames": ["Resource-Tags"]
      },
      {
        "policyDefinitionReferenceId": "PD-Custom-Tagging-CostCentre-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/Enforce-Resource-Tag",
        "parameters": {
          "tagName": { "value": "CostCentre" },
          "excludedResourceTypes": {
            "value": "[parameters('excludedResourceTypes')]"
          }
        },
        "groupNames": ["Resource-Tags"]
      },
      {
        "policyDefinitionReferenceId": "PD-Custom-Tagging-Criticality-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/Enforce-Resource-Tag",
        "parameters": {
          "tagName": { "value": "Criticality" },
          "excludedResourceTypes": {
            "value": "[parameters('excludedResourceTypes')]"
          }
        },
        "groupNames": ["Resource-Tags"]
      },
      {
        "policyDefinitionReferenceId": "PD-Custom-Tagging-VM-PatchGrp-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/Enforce-VM-Tag-and-Values",
        "parameters": {
          "tagName": {
            "value": "PatchGroup"
          },
          "tagValues": {
            "value": "[parameters('patchGroupTagValues')]"
          },
          "effect": {
            "value": "Deny"
          }
        },
        "groupNames": ["Resource-Tags"]
      },
      {
        "policyDefinitionReferenceId": "PD-Custom-Tagging-VM-Backup-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/Enforce-VM-Tag-and-Values",
        "parameters": {
          "tagName": {
            "value": "Backup"
          },
          "tagValues": {
            "value": "[parameters('backupTagValues')]"
          },
          "effect": {
            "value": "Deny"
          }
        },
        "groupNames": ["Resource-Tags"]
      }
    ],
    "policyDefinitionGroups": [
      {
        "name": "Resource-Tags",
        "displayName": "Mandatory Resource Tags",
        "description": "Group for mandatory tags on resources."
      }
    ]
  }
}
